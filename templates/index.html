<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Mood Detector</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white">
    <h1 class="text-2xl font-bold mb-4">Song Mood Detector</h1>

    <form id="song-form" class="flex gap-2 mb-4">
        <input type="text" id="song-title" name="song" placeholder="Enter song title..." class="px-4 py-2 text-black rounded">
        <button type="submit" class="px-4 py-2 bg-blue-600 rounded">Analyze</button>
    </form>

    <div class="flex w-full max-w-4xl gap-4">
        <!-- Lyrics Section -->
        <div id="lyrics" class="w-1/2 bg-gray-800 p-4 rounded-lg">
            <h2 class="text-lg font-bold mb-2">Lyrics</h2>
            <p class="text-gray-300">Lyrics will appear here...</p>
        </div>

        <!-- Graph Section -->
        <div id="chart-container" class="w-1/2 bg-gray-800 p-4 rounded-lg">
            <h2 class="text-lg font-bold mb-2">Sentiment Analysis</h2>
            <canvas id="sentimentChart"></canvas>
        </div>
    </div>

<script>
document.getElementById("song-form").addEventListener("submit", async function(event) {
    event.preventDefault(); // Prevent page reload

    let songTitle = document.getElementById("song-title").value.trim();
    if (!songTitle) return;

    try {
        let response = await fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ song: songTitle })
        });

        let data = await response.json();

        // Update lyrics
        document.getElementById("lyrics").innerHTML = `
            <h2 class="text-lg font-bold mb-2">Lyrics</h2>
            <p class="text-gray-300 whitespace-pre-wrap">${data.lyrics}</p>
        `;

        // Check if sentiment analysis data exists
        if (!data.score) {
            console.error("No sentiment score found in response!");
            return;
        }

        let ctx = document.getElementById('sentimentChart').getContext('2d');

        // **Fix: Check before destroying the old chart**
        if (window.sentimentChart && typeof window.sentimentChart.destroy === "function") {
            window.sentimentChart.destroy();
        }

        // Create new chart
        window.sentimentChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Negative', 'Neutral', 'Positive'],
                datasets: [{
                    label: 'Sentiment Score',
                    data: [data.score.neg, data.score.neu, data.score.pos],
                    backgroundColor: ['#ff4c4c', '#ffd700', '#4caf50']
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, max: 1 }
                }
            }
        });


    } catch (error) {
        console.error("Error fetching data:", error);
    }
});

</script>
</body>
</html>
